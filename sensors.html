<!DOCTYPE html>
<html manifest='offline.appcache'>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta content='initial-scale = 1.0,maximum-scale = 1.0' name='viewport' />
    <meta content='nl_NL' name='language' />
    <title>
      AQPlot
      sensors
    </title>
    <link rel="stylesheet" type="text/css" href="stylesheets/aqplot.css" media="screen" />
    <script src='javascripts/all.js'></script>
    <script>
      var host = $.jStorage.get('proxy-location', "http://127.0.0.1:5678/")
    </script>
  </head>
  <body>
    <div class='navbar navbar-fixed-top'>
      <div class='navbar-inner'>
        <div class='container'>
          <a class='btn btn-navbar' data-target='.nav-collapse' data-toggle='collapse'>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
          </a>
          <a class='brand' href=''>AeroQuad Plotter</a>
          <div class='nav-collapse collapse'>
            <ul class='nav'>
              <li>
                <a href=''>Home</a>
              </li>
              <li>
                <a href='dashboard.html'>Dashboard</a>
              </li>
              <li class='active'>
                <a href='sensors.html'>Sensors</a>
              </li>
              <li>
                <a href='receiver.html'>Receiver</a>
              </li>
              <li>
                <a href='engines.html'>Engines</a>
              </li>
            </ul>
            <ul class='nav pull-right'>
              <li>
                <a data-target='#settings' data-toggle='modal' href='#'>
                  <i class='icon icon-cog'></i>
                  Settings
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class='container' id='content'>
      <div class='row' id='sensors'>
  <div class='span12'>
    <div class='page-header'>
      <h2>Sensors</h2>
    </div>
  </div>
  <div class='span3'>
    <form class='form-inline'>
      <fieldset>
        <label class='checkbox'>
          <input checked='checked' type='checkbox' value='0'>Gyro Roll</input>
        </label>
        <label class='checkbox'>
          <input checked='checked' type='checkbox' value='1'>Gyro Pitch</input>
        </label>
        <label class='checkbox'>
          <input checked='checked' type='checkbox' value='2'>Gyro Yaw</input>
        </label>
        <label class='checkbox'>
          <input checked='checked' type='checkbox' value='3'>Axl X</input>
        </label>
        <label class='checkbox'>
          <input checked='checked' type='checkbox' value='4'>Axl Y</input>
        </label>
        <label class='checkbox'>
          <input checked='checked' type='checkbox' value='5'>Axl Z</input>
        </label>
      </fieldset>
    </form>
  </div>
  <div class='span9'>
    <canvas height='250' id='chart' width='700'></canvas>
  </div>
</div>
<script type='text/javascript'>
  //<![CDATA[
    grid = {
        fillStyle:'#fff',
        strokeStyle: '#ddd',
        lineWidth: 1,
        millisPerLine: 100,
        verticalSections: 4
    };
    labels = {
        fillStyle:'#000'
    }
    
    options = {
        grid: grid,
        labels: labels,
        interpolation: 'line',
    }
    
    // setup timeseries for every axis
    var gyrox = new TimeSeries();
    var gyroy = new TimeSeries();
    var gyroz = new TimeSeries();
    var axlx = new TimeSeries();
    var axly = new TimeSeries();
    var axlz = new TimeSeries();
    
    var chart = new SmoothieChart(options);
    
    function createTimeline() {
        chart.addTimeSeries(gyrox, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
        chart.addTimeSeries(gyroy, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
        chart.addTimeSeries(gyroz, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
        chart.addTimeSeries(axlx, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
        chart.addTimeSeries(axly, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
        chart.addTimeSeries(axlz, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
        chart.streamTo(document.getElementById("chart"), 100);
    }
    createTimeline();
    
    function getLog() {
        $.ajax({
            url:host+'/?command=i',
            complete: function() {
                setTimeout(getLog,100); //now that the request is complete, do it again in 1 second
            },
            success: function(data, status) {
                $('#log').prepend(data.join(',') + '\n')
                now = new Date().getTime()
                gyrox.append(now, data[0])
                gyroy.append(now, data[1])
                gyroz.append(now, data[2])
                axlx.append(now, data[3])
                axly.append(now, data[4])
                axlz.append(now, data[5])
            }
        });
    
    }
    
    getLog();
  //]]>
</script>
      <pre id='log'></pre>
      <form class='modal fade form-horizontal' id='settings' onsubmit='storeSettings();return false;'>
        <div class='modal-header'>
          <button aria-hidden='true' class='close' data-dismiss='modal' type='button'>&times;</button>
          <h3>Settings</h3>
        </div>
        <div class='modal-body'>
          <fieldset>
            <div class='control-group'>
              <label class='control-label'>
                Location of proxy
              </label>
              <div class='controls'>
                <input id='proxy-location' type='text' value='' />
              </div>
            </div>
          </fieldset>
        </div>
        <div class='modal-footer'>
          <input class='btn btn-primary' type='submit' value='Save' />
        </div>
      </form>
      <script type='text/javascript'>
        //<![CDATA[
          function storeSettings(){  
              $.jStorage.set('proxy-location', $('#proxy-location').val());
              
              $('#settings').modal('hide')
          }
          
          $(function() {
              $('#proxy-location').val($.jStorage.get('proxy-location', "http://127.0.0.1:5678/"));
          });
        //]]>
      </script>
    </div>
  </body>
</html>
