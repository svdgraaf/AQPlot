<!DOCTYPE html>
<html manifest='foooffline.appcache'>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta content='initial-scale = 1.0,maximum-scale = 1.0' name='viewport' />
    <meta content='nl_NL' name='language' />
    <title>
      AQPlot
      sensors
    </title>
    <link rel="stylesheet" type="text/css" href="stylesheets/aqplot.css" media="screen" />
    <script src='javascripts/all.js'></script>
    <script>
      var host = $.jStorage.get('proxy-location', "http://127.0.0.1:5678/")
    </script>
  </head>
  <body>
    <div class='navbar navbar-fixed-top'>
      <div class='navbar-inner'>
        <div class='container'>
          <a class='btn btn-navbar' data-target='.nav-collapse' data-toggle='collapse'>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
            <span class='icon-bar'></span>
          </a>
          <a class='brand' href=''>AeroQuad Plotter</a>
          <div class='nav-collapse collapse'>
            <ul class='nav'>
              <li>
                <a href='./'>Home</a>
              </li>
              <li>
                <a href='dashboard.html'>Dashboard</a>
              </li>
              <li class='active'>
                <a href='sensors.html'>Sensors</a>
              </li>
              <li>
                <a href='receiver.html'>Transmitter</a>
              </li>
              <li>
                <a href='engines.html'>Engines</a>
              </li>
            </ul>
            <ul class='nav pull-right'>
              <li>
                <a data-target='#settings' data-toggle='modal' href='#'>
                  <i class='icon icon-cog'></i>
                  Settings
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class='container' id='content'>
      <div class='row' id='sensors'>
  <div class='span12'>
    <div class='page-header'>
      <h2>Sensors</h2>
    </div>
  </div>
  <div class='span3'>
    <form class='form-inline'>
      <fieldset>
        <label class='checkbox'>
          <span class='swatch'></span>
          <pre id='gyro-roll-value'></pre>
          <input checked='checked' id='gyro-roll' onclick='return toggleAxis($(this));' type='checkbox' value='0' />
          <span>Gyro Roll</span>
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='gyro-pitch' onclick='return toggleAxis($(this));' type='checkbox' value='1' />
          <pre id='gyro-pitch-value'></pre>
          Gyro Pitch
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='gyro-yaw' onclick='return toggleAxis($(this));' type='checkbox' value='2' />
          <pre id='gyro-yaw-value'></pre>
          Gyro Yaw
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='axl-x' onclick='return toggleAxis($(this));' type='checkbox' value='3' />
          <pre id='axl-x-value'></pre>
          Axl X
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='axl-y' onclick='return toggleAxis($(this));' type='checkbox' value='4' />
          <pre id='axl-y-value'></pre>
          Axl Y
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='axl-z' onclick='return toggleAxis($(this));' type='checkbox' value='5' />
          <pre id='axl-z-value'></pre>
          Axl Z
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='mag-x' onclick='return toggleAxis($(this));' type='checkbox' value='6' />
          <pre id='mag-x-value'></pre>
          Mag x
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='mag-y' onclick='return toggleAxis($(this));' type='checkbox' value='7' />
          <pre id='mag-y-value'></pre>
          Mag Y
        </label>
        <label class='checkbox'>
          <span class='swatch'></span>
          <input checked='checked' id='mag-z' onclick='return toggleAxis($(this));' type='checkbox' value='8' />
          <pre id='mag-z-value'></pre>
          Mag Z
        </label>
      </fieldset>
    </form>
  </div>
  <div class='span9'>
    <canvas height='250' id='chart' width='700'></canvas>
  </div>
</div>
<script type='text/javascript'>
  //<![CDATA[
    function toggleAxis(checkbox) {
        $('#sensors input').each(function(i, o){
            if($(o).attr('id') == checkbox.attr('id')){
                console.log(checkbox.attr('checked'));
                if(checkbox.attr('checked') == 'checked'){
                    $($(o.parentNode).children()[0])
                    chart.addTimeSeries(axis[i], { strokeStyle: $($(o.parentNode).children()[0]).css('backgroundColor'), fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
                }
                else
                {
                    chart.removeTimeSeries(axis[i]);
                }
            }
        });
    }
    grid = {
        fillStyle:'#fff',
        strokeStyle: '#ddd',
        lineWidth: 1,
        millisPerLine: 100,
        verticalSections: 4
    };
    labels = {
        fillStyle:'#000'
    }
    
    options = {
        grid: grid,
        labels: labels,
        interpolation: 'line',
    }
    var chart = new SmoothieChart(options);
    
    // setup timeseries for every axis
    axis = []
    $('#sensors input').each(function(i,o){
        axis[i] = new TimeSeries();
        chart.addTimeSeries(axis[i], { strokeStyle: $($(o.parentNode).children()[0]).css('backgroundColor'), fillStyle: 'rgba(0,0,0, 0)', lineWidth: 3 });
    });
    chart.streamTo(document.getElementById("chart"), 100);
    
    function getLog() {
        $.ajax({
            url:host+'/?command=i',
            complete: function() {
                setTimeout(getLog,100); //now that the request is complete, do it again in 1 second
            },
            success: function(data, status) {
                $('#log').prepend(data.join(',') + '\n')
                now = new Date().getTime()
                $('#sensors input').each(function(i,o){
                    axis[i].append(now, data[$(o).val()]);
                    $('#' + $(o).attr('id') + '-value').text(data[$(o).val()])
                });
            }
        });
    
    }
    
    getLog();
  //]]>
</script>
      <pre id='log'></pre>
      <form class='modal fade form-horizontal' id='settings' onsubmit='storeSettings();return false;'>
        <div class='modal-header'>
          <button aria-hidden='true' class='close' data-dismiss='modal' type='button'>&times;</button>
          <h3>Settings</h3>
        </div>
        <div class='modal-body'>
          <fieldset>
            <div class='control-group'>
              <label class='control-label'>
                Location of proxy
              </label>
              <div class='controls'>
                <input id='proxy-location' type='text' value='' />
              </div>
            </div>
          </fieldset>
        </div>
        <div class='modal-footer'>
          <input class='btn btn-primary' type='submit' value='Save' />
        </div>
      </form>
      <script type='text/javascript'>
        //<![CDATA[
          function storeSettings(){  
              $.jStorage.set('proxy-location', $('#proxy-location').val());
              
              $('#settings').modal('hide')
          }
          
          $(function() {
              $('#proxy-location').val($.jStorage.get('proxy-location', "http://127.0.0.1:5678/"));
          });
        //]]>
      </script>
    </div>
  </body>
</html>
